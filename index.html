<html ng-app="custom-webapp-ui" lang="en" style="background-color: white">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <!-- Load the Telegram Library -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!--Load the AngularJS Library-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script>
        var imageFile = ""
        var firstName = ""
        var lastName = ""
        var NID = ""
        var DOB = ""
        var address =""
        var product = ""
        var phone = ""
 
        async function callOCR(){
            const formData = new FormData();
            formData.append('file', imageFile)
            const response = await fetch('https://pcla-biu-ml-services-hc6oexyfvq-as.a.run.app/ocr/nid',
            {
                method: 'POST',
                headers:{'APIAuthKey':'pclasecretapikey'},
                body: formData
            }).then(r=>r.json()).then(data => {
                firstName = data['Code'][2].split("<")[0].replace("<","")
                if (data['Code'][2].split("<")[1].replace("<","") != ""){
                lastName = data['Code'][2].split("<")[1].replace("<","")
                } else {
                    lastName = data['Code'][2].split("<")[2].replace("<","")
                }
                NID = data['NID'].split(' ')[0]
                DOB = data['Code'][1].substring(0,6)
                address = data['Address1'] + ' ' + data['Address2']
                console.log(data)
            
            })
            var y = document.getElementById("loaderSpin");
            y.style.display = "none";
            console.log(firstName)
            console.log(lastName)
            console.log(NID)
            console.log(DOB)
            console.log(address)
            document.getElementById("personalInfo").style.display = "block"
            document.getElementById("fname").value = firstName
            document.getElementById("lname").value = lastName
            document.getElementById("id").value = NID
            document.getElementById("add").value = address
            document.getElementById("phone").value = phone
            document.getElementById("product").value = product
            document.getElementById("birthdate").value = DOB
        }

        function showButton() {
            if (imageFile != "") {
                var x = document.getElementById("main");
                x.style.display = "none";
                var y = document.getElementById("loaderSpin");
                y.style.display = "block";
                const queryString = window.location.search;
                const urlParams = new URLSearchParams(queryString);
                product = urlParams.get('product')
                phone = urlParams.get('phone')
                callOCR()
            } else {
                alert('PLEASE UPLOAD NATIONAL ID OR PASSPORT!')
            }
        }


         function returnBackData() {
            const mainButton = window.Telegram.WebApp.MainButton;
            mainButton.text = "Save Preferences";
            mainButton.enable();
            mainButton.show();
            // and make it send the "foods" object (as JSON string) back to the bot
            mainButton.onClick(function () {
                window.Telegram.WebApp.sendData(JSON.stringify({ test: 'test' }));
            })
            mainButton.close();

        }

        function loadFile(event) {
            var image = document.getElementById('output');
            image.src = URL.createObjectURL(event.target.files[0]);
            imageFile = event.target.files[0]
        };

        function submitForOCR() {
            var x = document.getElementById("main");
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }


    </script>
</head>
<style>
    .loader {
        position: absolute;
        border: 12px solid #f3f3f3;
        /* Light grey */
        border-top: 12px solid #3498db;
        /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        top: 20%;
        left: 50%;
        margin-left: -50px;
        margin-top: -20px;
        animation: spin 2s linear infinite;
        display: none;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .header {
  overflow: hidden;
  background-color: #f1f1f1;
  padding: 20px 10px;
}

/* Style the header links */
.header a {
  float: left;
  color: black;
  text-align: center;
  padding: 12px;
  text-decoration: none;
  font-size: 18px;
  line-height: 25px;
  border-radius: 4px;
}

/* Style the logo link (notice that we set the same value of line-height and font-size to prevent the header to increase when the font gets bigger */
.header a.logo {
  font-size: 25px;
  font-weight: bold;
}

/* Change the background color on mouse-over */
.header a:hover {
  background-color: #ddd;
  color: black;
}

/* Style the active/current link*/
.header a.active {
  background-color: red;
  color: white;
}

/* Float the link section to the right */
.header-right {
  float: right;
}

/* Add media queries for responsiveness - when the screen is 500px wide or less, stack the links on top of each other */
@media screen and (max-width: 500px) {
  .header a {
    float: none;
    display: block;
    text-align: left;
  }
  .header-right {
    float: none;
  }
}
</style>

<body>
    <div>
        <div class="header">
            <img class="logo" style="width: calc(6vw + 6vh + 8vmin)" src="https://www.prudential.com.kh/export/sites/prudential-kh/km/.galleries/images/PCLA-logo.png" alt="Prudential Logo">
            <div class="header-right">
              <!-- <a class="active" href="#home">EN</a> -->
              <a href="#contact">ENGLISH</a>
            </div>
          </div>
        <div id="main">
            <!-- <img style="margin-top: 5%;margin-left: 4.5%;width: calc(10vw + 10vh + 15vmin);"
            src="https://www.prudential.com.kh/export/sites/prudential-kh/km/.galleries/images/PCLA-logo.png" alt="Prudential Logo"> -->
            <p style="margin-top: 1%;margin-left: 5%;font-size: calc(2.3vw + 2.3vh + 1vmin)">PRUeShop</p>
            <p style="margin-top: -3%;margin-left: 5%; font-weight: 200; font-size: calc(1vw + 1vh + 0.2vmin)">By
                Prudential Cambodia Life Assurance PLC</p>
            <br />
            <br />
            <p style="margin-left: 5%; font-weight: 200;font-size: calc(1vw + 1vh + 1vmin)">Upload your National ID or
                Passport</p>
            <br />
            <p style="margin-left: 5%;"><img id="output" width="400" /></p>
            <br />
            <input style="margin-left: 5%;font-size: calc(1.2vw + 1.2vh + 0.8vmin)" type="file" accept="image/*"
                id="image_uploads" name="image_uploads" onchange="loadFile(event)">
            <br />
            <Button onclick="showButton()" style="margin-top: calc(1vw + 1vh + 6vmin);margin-left: 20%;font-size:calc(1.2vw + 1.2vh + 0.8vmin); width: 60%;
     margin-bottom: calc(1vw + 1vh + 3vmin);
     ">Next</Button>
        </div>
        <div class="loader" id="loaderSpin"></div>
        <div id="personalInfo" style="display: none;">
            <p style="margin-top: 1%;margin-left: 5%;font-size: calc(2.3vw + 2.3vh + 1vmin)">PRUeShop</p>
            <p style="margin-top: -3%;margin-left: 5%; font-weight: 200; font-size: calc(1vw + 1vh + 0.2vmin)">By
                Prudential Cambodia Life Assurance PLC</p>
            <p style="margin-left: 5%; font-weight: 200;font-size: calc(1vw + 1vh + 1vmin)">Your Personal Information</p>
            <!-- <form style="margin-left: 5%">
                <label for="fname">First name:</label>
                <input type="text" id="fname" name="fname" style="width: 65%;"><br><br>
                <label for="lname">Last name:</label>
                <input type="text" id="lname" name="lname"  style="width: 65%;"><br><br>
                <label for="lname">Identi No:</label>
                <input type="text" id="id" name="id"  style="width: 65%;"><br><br>
                <label for="lname">Address:</label>
                <input type="text" id="add" name="add"  style="width: 65%;"><br><br>
                <label for="lname">Phone:</label>
                <input type="text" id="phone" name="phone"  style="width: 65%;"><br><br>
                <label for="lname">Product:</label>
                <input type="text" id="product" name="product"  style="width: 65%;"><br><br>
            </form> -->

            <form style="margin-left: 5%;margin-right: 15%;">
                <div class="form-group" style="margin-top: 1%;">
                  <label for="exampleInputEmail1" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">First name</label>
                  <input type="email" class="form-control" id="fname" aria-describedby="emailHelp" placeholder="Enter first name" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">
                  <small id="emailHelp" class="form-text text-muted">We'll never share your personal information with anyone else.</small>
                </div>
                <div class="form-group" style="margin-top: 1%;">
                    <label for="exampleInputEmail1" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">Last name</label>
                    <input type="email" class="form-control" id="lname" aria-describedby="emailHelp" placeholder="Enter last name" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">
                </div>
                <div class="form-group" style="margin-top: 1%;">
                    <label for="exampleInputEmail1" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">National/Passport Number</label>
                    <input type="email" class="form-control" id="id" aria-describedby="emailHelp" placeholder="Enter ID number" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">
                </div>
                <div class="form-group" style="margin-top: 1%;">
                    <label for="exampleInputEmail1" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">Phone Number</label>
                    <input type="email" class="form-control" id="phone" aria-describedby="emailHelp" placeholder="Enter phone number" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">
                </div>
                <div class="form-group" style="margin-top: 1%;">
                    <label for="exampleInputEmail1" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">Date of Birth</label>
                    <input type="email" class="form-control" id="birthdate" aria-describedby="emailHelp" placeholder="Enter date of birth" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">
                </div>
                <div class="form-group" style="margin-top: 1%;">
                    <label for="exampleInputEmail1" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">Chosen Product</label>
                    <input type="email" class="form-control" id="product" aria-describedby="emailHelp" placeholder="Enter chosen product" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">
                </div>
                <div class="form-group" style="margin-top: 1%;">
                    <label for="exampleInputEmail1" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">Address</label>
                    <input type="email" class="form-control" id="add" aria-describedby="emailHelp" placeholder="Enter address" style="font-size: calc(0.7vw + 0.7vh + 0.7vmin)">
                </div>
                <br/>
                <div class="form-check" style="margin-top: 1%;">
                  <input type="checkbox" class="form-check-input" id="exampleCheck1" style="font-size: calc(0.8vw + 0.8vh + 0.8vmin)">
                  <label class="form-check-label" for="exampleCheck1" style="font-size: calc(0.8vw + 0.8vh + 0.8vmin); font-weight: bold;">I declare the information above is correct, and I have read, understood and agreed to terms and conditions of the product stated above.</label>
                </div>
              </form>
            
        </div>

    </div>
</body>

</html>